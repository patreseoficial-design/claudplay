<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ClaudPlay</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="manifest" href="/manifest.json" />
  <link rel="apple-touch-icon" href="/icons/icon-192x192.png" />
  <meta name="theme-color" content="#6b00ff" />
</head>

<body>

<!-- =========================
     TELA DE LOGIN
========================= -->
<div id="loginScreen" class="loginScreen">
  <div class="loginBox">
    <h2 id="loginTitle">Entrar</h2>

    <input type="text" id="loginUser" placeholder="Usuário">
    <input type="password" id="loginPass" placeholder="Senha">

    <button id="btnLogin" class="btnPrimary">Entrar</button>

    <p id="loginMsg"></p>

    <p class="switchText">
      Não tem conta? <span id="btnSwitch" class="switchLink">Criar conta</span>
    </p>
  </div>
</div>

<!-- =========================
     PÁGINA PRINCIPAL
========================= -->
<div id="mainApp">

<header class="topo">
  <div class="logo">
    <span class="logoText">ClaudPlay</span>
  </div>

  <!-- ESPAÇO DO AVATAR -->
  <div class="avatarSpace">
    <div class="avatarCircle" id="avatarCircle">A</div>
  </div>

  <button id="btnLogout" class="logoutBtn">Sair</button>
</header>

<main class="container">

  <!-- BANNER PRINCIPAL -->
  <a href="javascript:void(0)" class="banner" id="bannerPrincipal">
    <div class="banner-img">
      <img src="Banner/mario_banner.jpeg" id="bannerImg" />
    </div>
    <div class="banner-info">
      <h1 id="bannerTitle">Super Mario World</h1>
      <p id="bannerDesc">Jogue direto no navegador</p>
    </div>
  </a>

  <!-- CARROSSEL (APENAS MAIS JOGADOS) -->
  <section class="carrossel">
    <div class="carrossel-title">
      <h2>Mais jogados</h2>
      <div class="carrossel-arrows">
        <button id="prev">⟵</button>
        <button id="next">⟶</button>
      </div>
    </div>

    <div class="carrossel-items" id="carrossel">
      <!-- OS JOGOS SERÃO GERADOS AQUI -->
    </div>
  </section>

  <!-- TODOS OS JOGOS (PLATAFORMAS) -->
  <section class="plataformas">
    <h2 class="sectionTitle">Todos os jogos</h2>
    <div class="plataformaItems" id="plataformasList">
      <!-- Plataformas vão aqui -->
    </div>
  </section>

</main>

<footer class="rodape">
  <p>Versão Beta • ClaudPlay ©</p>
</footer>

<!-- TELA DE PLATAFORMA (SEM RELOAD) -->
<div id="plataformaScreen" class="plataformaScreen">
  <button id="btnVoltar" class="btnVoltar">⬅ Voltar</button>
  <h2 id="plataformaTitle">Super Nintendo</h2>

  <div class="plataformaJogos" id="plataformaJogos">
    <!-- jogos da plataforma aqui -->
  </div>
</div>

<!-- ÁREA DO JOGO -->
<div id="jogoArea" class="jogoArea">
  <button onclick="fecharJogo()" class="btnFechar">⬅ Fechar</button>
  <iframe id="iframeJogo" class="iframeJogo"></iframe>
</div>

<div id="loadingOverlay" class="loadingOverlay">Carregando jogo...</div>

</div> <!-- FIM MAIN APP -->

<script>
/* =========================
   LOGIN + CADASTRO
========================= */
const loginScreen = document.getElementById("loginScreen");
const mainApp = document.getElementById("mainApp");
const btnLogin = document.getElementById("btnLogin");
const btnSwitch = document.getElementById("btnSwitch");
const loginTitle = document.getElementById("loginTitle");
const loginMsg = document.getElementById("loginMsg");
const btnLogout = document.getElementById("btnLogout");
const avatarCircle = document.getElementById("avatarCircle");

let modo = "login"; // login ou cadastro
let usuarioAtual = null;

function checarLogin(){
  const logado = localStorage.getItem("logado");
  if (logado === "true"){
    usuarioAtual = localStorage.getItem("userLogado");
    loginScreen.style.display = "none";
    mainApp.style.display = "block";
    btnLogout.style.display = "block";
checarLogin();
mostrarPlataformas();
    avatarCircle.innerText = usuarioAtual.charAt(0).toUpperCase();
    
  } else {
    loginScreen.style.display = "flex";
    mainApp.style.display = "none";
    btnLogout.style.display = "none";
  }
}

btnSwitch.onclick = () => {
  if (modo === "login"){
    modo = "cadastro";
    loginTitle.innerText = "Criar Conta";
    btnLogin.innerText = "Criar";
    btnSwitch.innerText = "Voltar ao login";
    loginMsg.innerText = "";
  } else {
    modo = "login";
    loginTitle.innerText = "Entrar";
    btnLogin.innerText = "Entrar";
    btnSwitch.innerText = "Criar conta";
    loginMsg.innerText = "";
  }
}

btnLogin.onclick = () => {
  const user = document.getElementById("loginUser").value;
  const pass = document.getElementById("loginPass").value;

  if (!user || !pass){
    loginMsg.innerText = "Preencha usuário e senha";
    return;
  }

  if (modo === "cadastro"){
    localStorage.setItem("user_" + user, pass);
    loginMsg.innerText = "Conta criada! Agora faça login";
    modo = "login";
    loginTitle.innerText = "Entrar";
    btnLogin.innerText = "Entrar";
    btnSwitch.innerText = "Criar conta";
  } else {
    const savedPass = localStorage.getItem("user_" + user);

    if (pass === savedPass){
      localStorage.setItem("logado", "true");
      localStorage.setItem("userLogado", user);
      usuarioAtual = user;
      checarLogin();
    } else {
      loginMsg.innerText = "Usuário ou senha incorretos";
    }
  }
}

btnLogout.onclick = () => {
  localStorage.setItem("logado", "false");
  localStorage.removeItem("userLogado");
  usuarioAtual = null;
  checarLogin();
}

/* =========================
   CARROSSEL + JOGOS
========================= */
const carrossel = document.getElementById("carrossel");
const bannerImg = document.getElementById("bannerImg");
const bannerTitle = document.getElementById("bannerTitle");
const bannerDesc = document.getElementById("bannerDesc");

let jogos = [];
let itens = [];
let indexAtual = 0;

async function carregarJogos(){
  const response = await fetch("Emuladores/SuperNintendo/games.json");
  jogos = await response.json();

  // Banner padrão caso não exista
  const bannerPadrao = "Banner/default_banner.png";

  carrossel.innerHTML = "";

  jogos.forEach((jogo, i) => {
    const imgBanner = jogo.banner ? "Banner/" + jogo.banner : bannerPadrao;

    const item = document.createElement("a");
    item.className = "item";
    item.dataset.title = jogo.title;
    item.dataset.desc = jogo.console;
    item.dataset.img = imgBanner;
    item.dataset.link = `Emuladores/SuperNintendo/snes.html?rom=${encodeURIComponent(jogo.rom)}`;

    item.innerHTML = `
      <img src="${item.dataset.img}">
    `;

    carrossel.appendChild(item);
  });

  itens = document.querySelectorAll(".item");
  atualizarEventos();
  mudarBanner(0);
}

function atualizarEventos(){
  itens.forEach((item, i) => {
    item.addEventListener("click", () => {
      indexAtual = i;
      mudarBanner(i);
      abrirJogo(item.dataset.link);
    });
  });
}

function mudarBanner(i){
  bannerImg.src = itens[i].dataset.img;
  bannerTitle.innerText = itens[i].dataset.title;
  bannerDesc.innerText = itens[i].dataset.desc;
}

document.getElementById("prev").onclick = () => {
  indexAtual = (indexAtual - 1 + itens.length) % itens.length;
  mudarBanner(indexAtual);
};

document.getElementById("next").onclick = () => {
  indexAtual = (indexAtual + 1) % itens.length;
  mudarBanner(indexAtual);
};

document.getElementById("bannerPrincipal").onclick = () => {
  abrirJogo(itens[indexAtual].dataset.link);
};

/* =========================
   PLATAFORMAS (SEM RELOAD)
========================= */
const plataformasList = document.getElementById("plataformasList");
const plataformaScreen = document.getElementById("plataformaScreen");
const plataformaTitle = document.getElementById("plataformaTitle");
const plataformaJogos = document.getElementById("plataformaJogos");
const btnVoltar = document.getElementById("btnVoltar");

const plataformas = [
  { name: "Super Nintendo", path: "Emuladores/SuperNintendo/games.json" }
];

function mostrarPlataformas(){
  plataformasList.innerHTML = "";

  plataformas.forEach(plataforma => {
    const div = document.createElement("div");
    div.className = "plataformaCard";
    div.innerHTML = `
      <h3>${plataforma.name}</h3>
      <p>Ver todos os jogos</p>
    `;

    div.onclick = () => abrirPlataforma(plataforma);
    plataformasList.appendChild(div);
  });
}

async function abrirPlataforma(plataforma){
  plataformaScreen.style.display = "block";
  document.querySelector("main").style.display = "none";

  plataformaTitle.innerText = plataforma.name;

  const res = await fetch(plataforma.path);
  const lista = await res.json();

  plataformaJogos.innerHTML = "";

  lista.forEach(jogo => {
    const imgBanner = jogo.banner ? "Banner/" + jogo.banner : "Banner/default_banner.png";
    const link = `Emuladores/SuperNintendo/snes.html?rom=${encodeURIComponent(jogo.rom)}`;

    const card = document.createElement("div");
    card.className = "jogoCard";
    card.innerHTML = `
      <img src="${imgBanner}">
      <div class="jogoCardInfo">
        <h4>${jogo.title}</h4>
        <p>${jogo.console}</p>
      </div>
    `;

    card.onclick = () => abrirJogo(link);
    plataformaJogos.appendChild(card);
  });
}

btnVoltar.onclick = () => {
  plataformaScreen.style.display = "none";
  document.querySelector("main").style.display = "block";
}

/* =========================
   ABRIR JOGO
========================= */
async function abrirJogo(url){
  document.getElementById("loadingOverlay").style.display = "flex";
  document.getElementById("jogoArea").style.display = "flex";
  const iframe = document.getElementById("iframeJogo");
  iframe.src = url;

  try { await document.documentElement.requestFullscreen(); } catch (e) {}
  try { await screen.orientation.lock("landscape"); } catch (e) {}

  iframe.onload = () => {
    document.getElementById("loadingOverlay").style.display = "none";
  };
}

function fecharJogo(){
  document.getElementById("jogoArea").style.display = "none";
  document.getElementById("iframeJogo").src = "";

  if (document.fullscreenElement) document.exitFullscreen();
  try { screen.orientation.unlock(); } catch (e) {}
}

/* =========================
   INICIALIZAÇÃO
========================= */
checarLogin();
carregarJogos();
mostrarPlataformas();

</script>

<style>
/* ===== LOGIN ===== */
.loginScreen{
  position:fixed;
  inset:0;
  background: linear-gradient(180deg, #0a0f18, #05070a);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:9999;
}

.loginBox{
  background: rgba(10, 13, 18, 0.9);
  border: 1px solid #2d6cff;
  padding: 30px 25px;
  border-radius: 16px;
  width: 90%;
  max-width: 380px;
  text-align:center;
  box-shadow: 0 0 30px rgba(45, 108, 255, 0.18);
}

.loginBox h2{
  margin: 0;
  font-size: 28px;
  color: #eaf1ff;
}

#loginMsg{
  margin-top: 8px;
  font-size: 14px;
  color: #c7d9ff;
}

.loginBox input{
  width:100%;
  margin: 12px 0;
  padding: 14px;
  border-radius: 12px;
  border: 1px solid #2d6cff;
  background:#0d1320;
  color:#eaf1ff;
  font-size: 16px;
}

.btnPrimary{
  width:100%;
  padding: 14px;
  border-radius: 12px;
  border: none;
  background: #2d6cff;
  color:#fff;
  font-weight: bold;
  font-size: 16px;
  cursor:pointer;
  margin-top: 10px;
  transition: 0.2s;
}

.btnPrimary:hover{
  background: #3a7bff;
}

.switchText{
  margin-top: 14px;
  color:#aebdff;
  font-size: 14px;
}

.switchLink{
  color:#2d6cff;
  cursor:pointer;
  font-weight: bold;
}

/* ===== ESSE TRECHO GARANTE QUE O LOGIN APARECE ===== */
#mainApp {
  display: none;
}
#loginScreen {
  display: flex;
}

/* ===== TOPO ===== */
.topo{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:10px 20px;
  background:#0c1018;
  color:#fff;
}

.logoText{
  font-weight:bold;
  font-size:22px;
}

.avatarSpace{
  width: 40px;
  height: 40px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 12px;
  display:flex;
  justify-content:center;
  align-items:center;
}

.avatarCircle{
  width: 30px;
  height: 30px;
  background: #2d6cff;
  border-radius: 50%;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:bold;
}

.logoutBtn{
  background:#2d6cff;
  color:#fff;
  border:none;
  padding:8px 12px;
  border-radius:10px;
  cursor:pointer;
}

/* BANNER */
.banner{
  display:flex;
  gap:20px;
  margin: 20px 0;
  text-decoration:none;
  color:#fff;
}

.banner-img img{
  width: 240px;
  height: 140px;
  border-radius: 12px;
  object-fit:cover;
}

.banner-info h1{
  margin:0;
  font-size: 22px;
}

.banner-info p{
  margin-top: 8px;
  font-size: 14px;
  color:#c7d9ff;
}

/* CARROSSEL */
.carrossel{
  margin-top: 20px;
}

.carrossel-title{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom: 10px;
}

.carrossel-title h2{
  font-size: 18px;
}

.carrossel-items{
  display:flex;
  gap:10px;
  overflow-x:auto;
  padding-bottom:10px;
}

.item{
  min-width: 160px;
  cursor:pointer;
  position:relative;
}

.item img{
  width: 160px;
  height: 90px;
  object-fit:cover;
  border-radius: 10px;
}

/* PLATAFORMAS */
.sectionTitle{
  font-size: 18px;
  margin-top: 30px;
}

.plataformaItems{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top: 10px;
}

.plataformaCard{
  width: 150px;
  padding: 12px;
  background: #111;
  border-radius: 12px;
  cursor:pointer;
  border: 1px solid rgba(255,255,255,0.08);
}

.plataformaCard h3{
  margin:0;
  font-size: 16px;
}

.plataformaCard p{
  margin-top: 8px;
  font-size: 12px;
  color:#c7d9ff;
}

/* TELA DA PLATAFORMA */
.plataformaScreen{
  display:none;
  position:fixed;
  inset:0;
  background:#07090f;
  z-index:999;
  padding: 20px;
}

.btnVoltar{
  background:#2d6cff;
  color:#fff;
  border:none;
  padding:8px 12px;
  border-radius:10px;
  cursor:pointer;
}

.plataformaJogos{
  margin-top: 20px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

.jogoCard{
  width: 160px;
  background:#111;
  border-radius:12px;
  padding:10px;
  cursor:pointer;
  border: 1px solid rgba(255,255,255,0.08);
}

.jogoCard img{
  width:100%;
  height: 90px;
  object-fit:cover;
  border-radius:8px;
}

.jogoCardInfo h4{
  margin:8px 0 0 0;
  font-size: 14px;
}

.jogoCardInfo p{
  margin:0;
  font-size: 12px;
  color:#c7d9ff;
}

/* =========================
   JOGO (CENTRALIZADO)
========================= */
.jogoArea{
  display:none;
  position:fixed;
  inset:0;
  background:#000;
  z-index:999;
  justify-content:center;
  align-items:center;
}

.iframeJogo{
  width: 90vw;
  height: 85vh;
  max-width: 1200px;
  max-height: 720px;
  border:none;
  border-radius: 10px;
  box-shadow: 0 0 20px rgba(255,255,255,0.12);
}

.btnFechar{
  position:absolute;
  top:10px;
  left:10px;
  z-index:1000;
  padding:8px 14px;
  font-size:14px;
  background:#2d6cff;
  color:#fff;
  border:none;
  border-radius:10px;
  cursor:pointer;
}

.loadingOverlay{
  display:none;
  position:fixed;
  inset:0;
  background:#000;
  z-index:1000;
  color:#fff;
  justify-content:center;
  align-items:center;
}
</style>

</body>
</html>