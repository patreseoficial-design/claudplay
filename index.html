<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ClaudPlay</title>
  <link rel="stylesheet" href="style.css" />

  <!-- =========================
       MANIFEST E ÃCONES PWA
  ========================= -->
  <link rel="manifest" href="/manifest.json" />
  <link rel="apple-touch-icon" href="/icons/icon-192x192.png" />
  <meta name="theme-color" content="#6b00ff" />
</head>

<body>

<!-- =========================
     TELA DE LOGIN
========================= -->
<div id="loginScreen" class="loginScreen">
  <div class="loginBox">
    <h2 id="loginTitle">Entrar</h2>

    <input type="text" id="loginUser" placeholder="UsuÃ¡rio">
    <input type="password" id="loginPass" placeholder="Senha">

    <button id="btnLogin" class="btnPrimary">Entrar</button>

    <p id="loginMsg"></p>

    <p class="switchText">
      NÃ£o tem conta? <span id="btnSwitch" class="switchLink">Criar conta</span>
    </p>
  </div>
</div>

<!-- =========================
     PÃGINA PRINCIPAL
========================= -->
<div id="mainApp">

<header class="topo">
  <div class="logo">
    ClaudPlay ðŸŽ®
    <span class="subtitle">â€¢ Jogos no navegador</span>
  </div>

  <!-- ESPAÃ‡O DO AVATAR -->
  <div class="avatarArea">
    <div class="avatarCircle" id="avatarCircle">ðŸ‘¤</div>
    <span id="userNameDisplay" class="userNameDisplay"></span>
  </div>

  <button id="btnLogout" class="logoutBtn">Sair</button>
</header>

<main class="container">

  <!-- TELA DE PLATAFORMAS -->
  <section class="plataformas" id="plataformasSec">
    <h2 class="sectionTitle">Plataformas</h2>
    <div class="plataformasGrid" id="plataformasGrid">
      <!-- Plataformas serÃ£o geradas aqui -->
    </div>
  </section>

  <!-- BANNER PRINCIPAL -->
  <a href="javascript:void(0)" class="banner" id="bannerPrincipal">
    <div class="banner-img">
      <img src="Banner/mario_banner.jpeg" id="bannerImg" />
    </div>
    <div class="banner-info">
      <h1 id="bannerTitle">Super Mario World</h1>
      <p id="bannerDesc">Jogue direto no navegador</p>
    </div>
  </a>

  <!-- CARROSSEL (DESTAQUES) -->
  <section class="carrossel">
    <div class="carrossel-title">
      <h2>Destaques</h2>
      <div class="carrossel-arrows">
        <button id="prev">âŸµ</button>
        <button id="next">âŸ¶</button>
      </div>
    </div>

    <div class="carrossel-items" id="carrossel">
      <!-- OS JOGOS SERÃƒO GERADOS AQUI -->
    </div>
  </section>

  <!-- TELA DE JOGOS (Netflix Style) -->
  <section class="gamesScreen" id="gamesScreen">
    <div class="gamesHeader">
      <h2 id="gamesTitle"></h2>
      <button id="btnBack" class="backBtn">Voltar</button>
    </div>
    <div class="gamesGrid" id="gamesGrid"></div>
  </section>

  <!-- FAVORITOS -->
  <section class="favoritos" id="favoritosSec">
    <h2>Favoritos</h2>
    <div class="favoritos-items" id="favoritosItems"></div>
  </section>

</main>

<footer class="rodape">
  <p>VersÃ£o Beta â€¢ ClaudPlay Â©</p>
</footer>

<!-- ÃREA DO JOGO -->
<div id="jogoArea" class="jogoArea">
  <button onclick="fecharJogo()" class="btnFechar">â¬… Fechar</button>
  <iframe id="iframeJogo" class="iframeJogo"></iframe>
</div>

<div id="loadingOverlay" class="loadingOverlay">Carregando jogo...</div>

</div> <!-- FIM MAIN APP -->

<script>
/* =========================
   LOGIN + CADASTRO
======================== */
const loginScreen = document.getElementById("loginScreen");
const mainApp = document.getElementById("mainApp");
const btnLogin = document.getElementById("btnLogin");
const btnSwitch = document.getElementById("btnSwitch");
const loginTitle = document.getElementById("loginTitle");
const loginMsg = document.getElementById("loginMsg");
const btnLogout = document.getElementById("btnLogout");
const userNameDisplay = document.getElementById("userNameDisplay");

let modo = "login";
let usuarioAtual = null;

function checarLogin(){
  const logado = localStorage.getItem("logado");
  if (logado === "true"){
    usuarioAtual = localStorage.getItem("userLogado");
    loginScreen.style.display = "none";
    mainApp.style.display = "block";
    btnLogout.style.display = "block";
    userNameDisplay.innerText = usuarioAtual;
    carregarFavoritos();
    carregarPlataformas();
    carregarJogosSNES();
  } else {
    loginScreen.style.display = "flex";
    mainApp.style.display = "none";
    btnLogout.style.display = "none";
  }
}

btnSwitch.onclick = () => {
  if (modo === "login"){
    modo = "cadastro";
    loginTitle.innerText = "Criar Conta";
    btnLogin.innerText = "Criar";
    btnSwitch.innerText = "Voltar ao login";
    loginMsg.innerText = "";
  } else {
    modo = "login";
    loginTitle.innerText = "Entrar";
    btnLogin.innerText = "Entrar";
    btnSwitch.innerText = "Criar conta";
    loginMsg.innerText = "";
  }
}

btnLogin.onclick = () => {
  const user = document.getElementById("loginUser").value;
  const pass = document.getElementById("loginPass").value;

  if (!user || !pass){
    loginMsg.innerText = "Preencha usuÃ¡rio e senha";
    return;
  }

  if (modo === "cadastro"){
    localStorage.setItem("user_" + user, pass);
    loginMsg.innerText = "Conta criada! Agora faÃ§a login";
    modo = "login";
    loginTitle.innerText = "Entrar";
    btnLogin.innerText = "Entrar";
    btnSwitch.innerText = "Criar conta";
  } else {
    const savedPass = localStorage.getItem("user_" + user);

    if (pass === savedPass){
      localStorage.setItem("logado", "true");
      localStorage.setItem("userLogado", user);
      usuarioAtual = user;
      checarLogin();
    } else {
      loginMsg.innerText = "UsuÃ¡rio ou senha incorretos";
    }
  }
}

btnLogout.onclick = () => {
  localStorage.setItem("logado", "false");
  localStorage.removeItem("userLogado");
  usuarioAtual = null;
  checarLogin();
}

/* =========================
   PLATAFORMAS (Netflix Style)
======================== */
const plataformasGrid = document.getElementById("plataformasGrid");
const gamesScreen = document.getElementById("gamesScreen");
const gamesGrid = document.getElementById("gamesGrid");
const gamesTitle = document.getElementById("gamesTitle");
const btnBack = document.getElementById("btnBack");

let plataformas = [
  { id: "snes", name: "Super Nintendo", icon: "ðŸŽ®", json: "Emuladores/SuperNintendo/games.json" }
];

btnBack.onclick = () => {
  gamesScreen.style.display = "none";
  plataformasGrid.parentElement.style.display = "block";
};

function carregarPlataformas(){
  plataformasGrid.innerHTML = "";
  plataformas.forEach(plata => {
    const div = document.createElement("div");
    div.className = "plataformaItem";
    div.innerHTML = `
      <div class="plataformaIcon">${plata.icon}</div>
      <div class="plataformaName">${plata.name}</div>
    `;
    div.onclick = () => abrirPlataforma(plata);
    plataformasGrid.appendChild(div);
  });
}

async function abrirPlataforma(plata){
  plataformasGrid.parentElement.style.display = "none";
  gamesScreen.style.display = "block";
  gamesTitle.innerText = plata.name;

  const response = await fetch(plata.json);
  const jogos = await response.json();

  gamesGrid.innerHTML = "";
  jogos.forEach(jogo => {
    const div = document.createElement("div");
    div.className = "gameItem";
    div.innerHTML = `
      <img src="Banner/${jogo.banner || 'default_banner.png'}">
      <div class="gameInfo">
        <h3>${jogo.title}</h3>
        <p>${jogo.console}</p>
      </div>
      <button class="btnPlay">Jogar</button>
    `;
    div.querySelector(".btnPlay").onclick = () => abrirJogo(`Emuladores/SuperNintendo/snes.html?rom=${encodeURIComponent(jogo.rom)}`);
    gamesGrid.appendChild(div);
  });
}

/* =========================
   CARROSSEL DINÃ‚MICO DO JSON (DESTAQUES)
========================= */
const carrossel = document.getElementById("carrossel");
const bannerImg = document.getElementById("bannerImg");
const bannerTitle = document.getElementById("bannerTitle");
const bannerDesc = document.getElementById("bannerDesc");
const favoritosItems = document.getElementById("favoritosItems");

let jogos = [];
let itens = [];
let indexAtual = 0;

async function carregarJogosSNES(){
  const response = await fetch("Emuladores/SuperNintendo/games.json");
  jogos = await response.json();

  carrossel.innerHTML = "";

  // Selecionar sÃ³ alguns para o carrossel (destaques)
  const destaques = jogos.slice(0, 10);

  destaques.forEach((jogo, i) => {
    const item = document.createElement("a");
    item.className = "item";
    item.dataset.title = jogo.title;
    item.dataset.desc = jogo.console;
    item.dataset.img = jogo.banner ? ("Banner/" + jogo.banner) : "Banner/default_banner.png";
    item.dataset.link = `Emuladores/SuperNintendo/snes.html?rom=${encodeURIComponent(jogo.rom)}`;

    item.innerHTML = `
      <img src="${item.dataset.img}">
      <span class="itemTitle">${jogo.title}</span>
    `;

    carrossel.appendChild(item);
  });

  itens = document.querySelectorAll(".item");
  atualizarEventos();
  mudarBanner(0);
}

function atualizarEventos(){
  itens.forEach((item, i) => {
    item.addEventListener("click", () => {
      indexAtual = i;
      mudarBanner(i);
      abrirJogo(item.dataset.link);
    });
  });
}

function mudarBanner(i){
  bannerImg.src = itens[i].dataset.img;
  bannerTitle.innerText = itens[i].dataset.title;
  bannerDesc.innerText = itens[i].dataset.desc;
}

document.getElementById("prev").onclick = () => {
  indexAtual = (indexAtual - 1 + itens.length) % itens.length;
  mudarBanner(indexAtual);
};

document.getElementById("next").onclick = () => {
  indexAtual = (indexAtual + 1) % itens.length;
  mudarBanner(indexAtual);
};

document.getElementById("bannerPrincipal").onclick = () => {
  abrirJogo(itens[indexAtual].dataset.link);
}

/* =========================
   FAVORITOS
======================== */
function carregarFavoritos(){
  favoritosItems.innerHTML = "";
  const favKey = "fav_" + usuarioAtual;
  const favs = JSON.parse(localStorage.getItem(favKey) || "[]");

  favs.forEach(fav => {
    const div = document.createElement("div");
    div.className = "favItem";
    div.innerHTML = `
      <img src="Banner/${fav.banner || 'default_banner.png'}">
      <div class="favInfo">
        <h3>${fav.title}</h3>
        <p>${fav.console}</p>
      </div>
      <button class="remFav">Remover</button>
    `;
    div.querySelector(".remFav").onclick = () => removerFavorito(fav.rom);
    div.onclick = () => abrirJogo(`Emuladores/SuperNintendo/snes.html?rom=${encodeURIComponent(fav.rom)}`);
    favoritosItems.appendChild(div);
  });
}

function removerFavorito(rom){
  const favKey = "fav_" + usuarioAtual;
  let favs = JSON.parse(localStorage.getItem(favKey) || "[]");
  favs = favs.filter(f => f.rom !== rom);
  localStorage.setItem(favKey, JSON.stringify(favs));
  carregarFavoritos();
}

/* =========================
   ABRIR JOGO
======================== */
async function abrirJogo(url){
  document.getElementById("loadingOverlay").style.display = "flex";
  document.getElementById("jogoArea").style.display = "flex";
  const iframe = document.getElementById("iframeJogo");
  iframe.src = url;

  try { await document.documentElement.requestFullscreen(); } catch (e) {}
  try { await screen.orientation.lock("landscape"); } catch (e) {}

  iframe.onload = () => {
    document.getElementById("loadingOverlay").style.display = "none";
  };
}

function fecharJogo(){
  document.getElementById("jogoArea").style.display = "none";
  document.getElementById("iframeJogo").src = "";

  if (document.fullscreenElement) document.exitFullscreen();
  try { screen.orientation.unlock(); } catch (e) {}
}

/* =========================
   INICIALIZAÃ‡ÃƒO
======================== */
checarLogin();

</script>

</body>
</html>